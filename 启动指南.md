# 🚀 崔子瑾诱捕器 - 启动指南

## ⚡ 快速启动 (推荐)

### 方法一：一键启动脚本

项目提供了智能启动脚本，自动处理所有启动步骤：

```bash
# 1. 进入项目目录
cd website_version2

# 2. 运行一键启动脚本
chmod +x quick-start.sh
./quick-start.sh
```

**脚本功能**：
- ✅ 自动检查Node.js和npm版本
- ✅ 自动安装缺失的依赖
- ✅ 启动开发服务器
- ✅ 启动Electron应用
- ✅ 提供详细的状态反馈

**可选参数**：
```bash
./quick-start.sh --china      # 使用中国镜像源（网络慢时推荐）
./quick-start.sh --help       # 查看帮助信息
./quick-start.sh --stop       # 停止所有进程
./quick-start.sh --clean      # 清理并重新安装依赖
```

### 方法二：手动启动

如果需要更多控制，可以手动启动：

```bash
# 1. 安装依赖（首次运行）
npm install

# 2. 启动开发服务器
npm run dev

# 3. 在新终端窗口启动Electron应用
npm run electron:dev
```

## 📱 应用使用流程

### 1. 首次设置

应用启动后会显示首次设置页面：

1. **设置管理员密码**
   - 输入密码（至少6个字符）
   - 确认密码
   - 点击"完成设置"

2. **等待初始化**
   - 应用会自动初始化数据库
   - 创建必要的配置文件
   - 设置安全模块

### 2. 登录应用

1. 输入刚才设置的管理员密码
2. 点击"登录"进入控制台

### 3. 启动网站拦截功能

#### 🔧 启动代理服务器

1. 进入"代理控制"页面
2. 点击"启动代理"开关
3. **系统代理会自动配置** ⭐ (修复后的核心功能)
4. 确认"系统代理设置"显示为"已启用"

#### 📋 添加要拦截的网站

1. 进入"网站管理"页面
2. 点击"添加网站"按钮
3. 输入网站信息：
   - 网站URL（如：https://example.com）
   - 网站标题（可选）
4. 启用"拦截开关"
5. 点击"保存"

#### ✅ 验证拦截效果

1. 使用浏览器访问被拦截的网站
2. 应该看到拦截页面而不是原网站内容
3. 在应用中查看拦截统计

## 🛠️ 故障排除

### 常见问题及解决方案

#### 1. 应用启动失败

**问题**：`npm run dev` 或 `npm run electron:dev` 失败

**解决方案**：
```bash
# 清理并重新安装依赖
rm -rf node_modules package-lock.json
npm install

# 或使用一键脚本的清理功能
./quick-start.sh --clean
```

#### 2. 代理服务器启动失败

**问题**：代理服务器无法启动，端口被占用

**解决方案**：
```bash
# 检查端口占用
lsof -i :8080

# 终止占用进程
kill -9 <PID>

# 或重启应用
./quick-start.sh --stop
./quick-start.sh
```

#### 3. 系统代理配置失败

**问题**：系统代理设置显示"未启用"

**解决方案**：
1. 确保应用有管理员权限
2. 手动配置浏览器代理：
   - HTTP代理：127.0.0.1:8080
   - HTTPS代理：127.0.0.1:8080
3. 或使用应用中的"系统代理设置"手动开关

#### 4. 网站拦截不生效

**问题**：启用拦截后仍能正常访问网站

**检查清单**：
- ✅ 代理服务器是否正在运行
- ✅ 系统代理是否已配置
- ✅ 网站是否已添加到黑名单
- ✅ 网站拦截开关是否已启用
- ✅ 浏览器是否使用了代理设置

#### 5. 数据库相关错误

**问题**：better-sqlite3 编译失败

**解决方案**：
```bash
# 重新编译 better-sqlite3
npm rebuild better-sqlite3

# 如果仍然失败，应用会自动使用 FileDatabase 备用方案
# 功能不受影响，只是性能略有差异
```

## 🔧 开发模式

### 调试和开发

```bash
# 启动开发模式（热重载）
npm run dev

# 查看主进程日志
npm run dev:main

# 查看渲染进程日志
npm run dev:renderer

# 运行测试
npm test

# 构建生产版本
npm run build

# 打包应用
npm run dist
```

### 开发工具

- **React DevTools**：自动安装在开发模式
- **Electron DevTools**：F12 打开开发者工具
- **日志查看**：控制台输出详细的调试信息

## 📊 性能监控

应用内置了性能监控功能：

- **代理服务器状态**：实时显示运行状态
- **拦截统计**：显示拦截次数和趋势
- **系统资源**：监控CPU和内存使用
- **错误日志**：记录和显示错误信息

## 🔒 安全特性

- **进程保护**：防止恶意终止
- **配置加密**：敏感配置自动加密
- **绕过检测**：监控hosts文件修改
- **权限管理**：最小权限原则

## 📞 获取帮助

如果遇到问题：

1. **查看日志**：应用会输出详细的调试信息
2. **检查文档**：参考 `docs/` 目录下的详细文档
3. **运行测试**：使用 `npm test` 验证功能
4. **重置应用**：删除配置文件重新初始化

## 🎯 快速验证

启动后快速验证功能是否正常：

```bash
# 1. 启动应用
./quick-start.sh

# 2. 运行功能测试
node test-blocking-functionality.js

# 3. 查看测试报告
cat 测试报告-网站拦截功能修复验证.md
```

---

**🎉 恭喜！您的崔子瑾诱捕器现在已经具备完整的网站拦截功能！**

修复后的核心改进：
- ✅ **自动系统代理配置** - 启动代理时自动设置系统代理
- ✅ **智能域名匹配** - 支持通配符和子域名拦截
- ✅ **清晰状态反馈** - 实时显示代理和拦截状态
- ✅ **完善错误处理** - 详细的日志和错误提示
- ✅ **跨平台支持** - macOS、Windows、Linux全平台支持
